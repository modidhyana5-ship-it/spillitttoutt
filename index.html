<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Spill It Out ðŸ’¬ â€” Preview</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #fff5f7;
    --bg2: #fff0f6;
    --accent: #ff6b9a;
    --accent-dark: #e04976;
    --muted: #7a7a7a;
    --card: #ffffff;
    --glass: rgba(255,255,255,0.6);
  }
  *{box-sizing:border-box;font-family:'Poppins',system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#222;}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px;}
  .app{
    width:100%;max-width:820px;background:var(--card);border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,0.08);
    display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start;
  }
  @media (max-width:880px){.app{grid-template-columns:1fr;}.right{order:2}}
  .header{display:flex;align-items:center;gap:14px;margin-bottom:6px;}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;box-shadow:0 6px 18px rgba(224,73,118,0.16)}
  h1{margin:0;font-size:20px;}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  /* Left (composer) */
  .composer{padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);background:linear-gradient(180deg,#fff,#fff);}
  textarea{width:100%;min-height:160px;resize:none;padding:14px;border-radius:10px;border:1px solid rgba(255,107,154,0.18);outline:none;font-size:15px;line-height:1.45;font-family:inherit;background:transparent;transition:box-shadow .18s,transform .12s;}
  textarea:focus{box-shadow:0 8px 30px rgba(239,93,128,0.12);transform:translateY(-2px)}

  .controls{display:flex;align-items:center;justify-content:space-between;margin-top:10px;gap:12px}
  .left-controls{display:flex;align-items:center;gap:8px}
  .btn{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer;box-shadow:0 8px 20px rgba(255,107,154,0.12);transition:transform .12s,box-shadow .12s}
  .btn:active{transform:translateY(1px)}
  .btn.ghost{background:transparent;color:var(--accent);box-shadow:none;border:1px solid rgba(255,107,154,0.12)}

  .counter{font-size:13px;color:var(--muted)}

  /* Right (messages list) */
  .right{padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.4));min-height:280px}
  .right h3{margin:0 0 8px 0;font-size:16px}
  .msg-list{display:flex;flex-direction:column;gap:10px;max-height:480px;overflow:auto;padding-right:6px;}
  .msg{background:linear-gradient(180deg,#fff,#fff);padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 6px 18px rgba(10,10,10,0.03)}
  .meta{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
  .meta .id{font-weight:600;color:var(--accent)}
  .meta .date{font-size:12px;color:var(--muted)}

  .empty{color:var(--muted);font-size:14px;padding:8px;text-align:center}

  /* toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:26px;background:var(--accent);color:white;padding:10px 16px;border-radius:10px;box-shadow:0 12px 30px rgba(224,73,118,0.14);opacity:0;pointer-events:none}
  .toast.show{opacity:1;pointer-events:auto;animation:toastIn .35s ease}
  @keyframes toastIn{from{transform:translateX(-50%) translateY(8px) scale(.98)}to{transform:translateX(-50%) translateY(0) scale(1)}}

  /* small helpers */
  .small{font-size:13px;color:var(--muted)}
  .flex{display:flex;gap:8px;align-items:center}
  .search{width:100%;padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);outline:none}
  .controls .danger{background:#ffefef;color:#d23a5a;border:1px solid rgba(210,58,90,0.08)}

</style>
</head>
<body>
<div class="wrap">
  <div class="app" role="application" aria-label="Spill It Out app">
    <div class="left">
      <div class="header">
        <div class="logo">SI</div>
        <div>
          <h1>Spill It Out ðŸ’¬</h1>
          <p class="lead">Write freely â€” your entries are saved locally. Delete only when you command.</p>
        </div>
      </div>

      <div class="composer" aria-live="polite">
        <label for="note" class="small">What's on your mind?</label>
        <textarea id="note" placeholder="Type or paste anything..."></textarea>

        <div class="controls" style="margin-top:12px">
          <div class="left-controls">
            <button id="saveBtn" class="btn">Save</button>
            <button id="clearDraft" class="btn ghost" title="Clear draft (not saved)">Clear Draft</button>
            <div class="counter small" id="counter">0 characters</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <input id="searchInput" class="search" placeholder="Search messages..." title="Filter messages by text" />
          </div>
        </div>
      </div>

      <div style="margin-top:14px" class="small">Tip: Press <strong>Ctrl/Cmd + Enter</strong> to save quickly. Messages are stored only on this device.</div>
    </div>

    <div class="right">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
        <h3>Saved Messages</h3>
        <div class="flex">
          <div class="small" id="totalCount">0 messages</div>
          <button id="deleteAll" class="btn danger" title="Delete all saved messages">Delete All</button>
        </div>
      </div>

      <div class="msg-list" id="msgList" aria-live="polite"></div>
      <div id="emptyState" class="empty" style="display:none">No saved messages yet â€” write something and hit Save.</div>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
(function(){
  const STORAGE_KEY = "spill_messages_v1";
  const note = document.getElementById('note');
  const saveBtn = document.getElementById('saveBtn');
  const clearDraftBtn = document.getElementById('clearDraft');
  const msgList = document.getElementById('msgList');
  const deleteAll = document.getElementById('deleteAll');
  const counter = document.getElementById('counter');
  const totalCount = document.getElementById('totalCount');
  const emptyState = document.getElementById('emptyState');
  const searchInput = document.getElementById('searchInput');
  const toast = document.getElementById('toast');

  // Utilities
  function nowISO(){ return new Date().toISOString(); }
  function niceDate(iso){ const d=new Date(iso); return d.toLocaleString(); }

  function loadMessages(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){
      console.error("load error", e);
      return [];
    }
  }

  function saveMessages(arr){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  }

  function showToast(msg, timeout=1800){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), timeout);
  }

  function renderList(filter=""){
    const messages = loadMessages();
    const filtered = filter ? messages.filter(m=>m.text.toLowerCase().includes(filter.toLowerCase())) : messages;
    msgList.innerHTML = '';
    if(filtered.length===0){
      emptyState.style.display = 'block';
    } else {
      emptyState.style.display = 'none';
    }
    filtered.slice().reverse().forEach((m, idx)=>{
      const el = document.createElement('div');
      el.className = 'msg';
      const meta = document.createElement('div');
      meta.className = 'meta';
      const idSpan = document.createElement('div');
      idSpan.className = 'id';
      idSpan.textContent = `Message #${m.id}`;
      const dateSpan = document.createElement('div');
      dateSpan.className = 'date';
      dateSpan.textContent = niceDate(m.createdAt);
      meta.appendChild(idSpan);
      meta.appendChild(dateSpan);

      const text = document.createElement('div');
      text.textContent = m.text;
      text.style.whiteSpace = 'pre-wrap';
      text.style.marginTop = '6px';

      el.appendChild(meta);
      el.appendChild(text);

      // add single-delete button
      const controls = document.createElement('div');
      controls.style.marginTop = '8px';
      controls.style.display = 'flex';
      controls.style.justifyContent = 'flex-end';
      const del = document.createElement('button');
      del.className = 'btn ghost';
      del.textContent = 'Delete';
      del.onclick = ()=>{
        if(!confirm('Delete this message?')) return;
        const all = loadMessages();
        const next = all.filter(x=>x.id !== m.id);
        saveMessages(next);
        renderList(searchInput.value);
        showToast('Message deleted');
      };
      controls.appendChild(del);
      el.appendChild(controls);

      msgList.appendChild(el);
    });
    totalCount.textContent = `${messages.length} message${messages.length!==1 ? 's' : ''}`;
  }

  function addMessage(text){
    if(!text || !text.trim()) return showToast('Cannot save an empty message.');
    const messages = loadMessages();
    const nextId = messages.length ? (Math.max(...messages.map(m=>m.id)) + 1) : 1;
    const obj = { id: nextId, text: text.trim(), createdAt: nowISO() };
    messages.push(obj);
    saveMessages(messages);
    renderList(searchInput.value);
    showToast('Saved');
    note.value = '';
    updateCounter();
  }

  // Auto-save draft to sessionStorage (so draft is separate from saved messages)
  const DRAFT_KEY = 'spill_draft_v1';
  function saveDraft(){ sessionStorage.setItem(DRAFT_KEY, note.value); }
  function loadDraft(){ note.value = sessionStorage.getItem(DRAFT_KEY) || ''; updateCounter(); }
  function clearDraft(){ note.value = ''; sessionStorage.removeItem(DRAFT_KEY); updateCounter(); showToast('Draft cleared'); }

  // Event bindings
  saveBtn.addEventListener('click', ()=> addMessage(note.value));
  clearDraftBtn.addEventListener('click', ()=> { if(confirm('Clear the draft?')) clearDraft(); });

  note.addEventListener('input', ()=>{ saveDraft(); updateCounter(); autoResize(note); });
  note.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ addMessage(note.value); } });

  deleteAll.addEventListener('click', ()=>{
    if(!confirm('Delete ALL saved messages? This cannot be undone.')) return;
    localStorage.removeItem(STORAGE_KEY);
    renderList();
    showToast('All messages deleted');
  });

  searchInput.addEventListener('input', ()=> renderList(searchInput.value));

  function updateCounter(){
    const len = note.value.length;
    counter.textContent = `${len} character${len!==1 ? 's' : ''}`;
  }

  function autoResize(el){
    el.style.height = 'auto';
    el.style.height = (el.scrollHeight) + 'px';
  }

  // Initialize
  loadDraft();
  renderList();

  // Accessibility: focus on textarea
  note.focus();

  // expose for debug in devtools
  window.__spill = {
    loadMessages, saveMessages, addMessage, renderList
  };

})();
</script>
</body>
</html>
